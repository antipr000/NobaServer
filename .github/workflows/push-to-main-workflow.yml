name: SonarCloud Update

on:
  # Run whenever we push to main
  push:
    branches: main

  # Allow running manually from GitHub
  workflow_dispatch:

jobs:
  setup-environment:
    uses: ./.github/workflows/setup-environment.yml

  run-unit-tests:
    uses: ./.github/workflows/run-unit-tests.yml
    secrets: inherit
    needs: [setup-environment]

  sonarcloud-scan:
    uses: ./.github/workflows/run-sonar-scan.yml
    secrets: inherit
    needs: [setup-environment, run-unit-tests]
